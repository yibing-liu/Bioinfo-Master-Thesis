---
title: "R Notebook"
output: html_notebook
---
[1] "CN1 estimate paramaters"
mean         sd 
-0.9047569  0.7468480 
[1] "CN2 estimate paramaters"
mean          sd 
-0.01629146  0.49248766 
[1] "CN3 estimate paramaters"
mean        sd 
0.4942913 0.5122417 
################SET BASIC PARAMETERS##################
```{r}
#normal distribution parameters
mean_cn1 = -0.9047569
mean_cn2 = -0.01629146
mean_cn3 = 0.4942913

sd_cn1 = 0.7468480
sd_cn2 = 0.49248766
sd_cn3 = 0.5122417

```
```{r}
library(openxlsx)

stimulate_dataset_list = loadWorkbook('Stimulate dataset list.xlsx')
# Renaming sheets to removes spaces in names
sheetNames = sheets(stimulate_dataset_list)
sheetNames = lapply(sheetNames, trimws) # Trimming away trailing space

newSheetNames = c()
for (sheetName in sheetNames) {
  sheetName = gsub(" ", "_", sheetName)
  newSheetNames[sheetName] = sheetName 
}
sheetNames = newSheetNames

# Assigning each sheet to a dataframe
for(i in 1:length(sheetNames)){
  assign(sheetNames[i],readWorkbook(stimulate_dataset_list,sheet = i))
}

Control = Control[-1,]
colnames(Control) = c("control", "total_number_of_samples", "length", "cn2_number_of_samples", "cn2_proportion", "cn1_number_of_samples", "cn1_proportion", "cnv_size", "size_proportion", "cnv_start", "cnv_end",  "cn3_number_of_samples", "cn3_proportion", "cnv_size", "size_proportion", "cnv_start", "cnv_end")

Single_CNV = Single_CNV[-1,]
colnames(Single_CNV) = c("total_number_of_samples", "length", "cn2_number_of_samples", "cn2_proportion", "cn1_number_of_samples", "cn1_proportion", "cnv_size", "size_proportion", "cnv_start", "cnv_end",  "cn3_number_of_samples", "cn3_proportion", "cnv_size", "size_proportion", "cnv_start", "cnv_end")

CN1_CN3 = CN1_CN3[-1,]
colnames(CN1_CN3) = c("total_number_of_samples", "length", "cn2_number_of_samples", "cn2_proportion", "cn1_number_of_samples", "cn1_proportion", "cnv_size", "size_proportion", "cnv_start", "cnv_end",  "cn3_number_of_samples", "cn3_proportion", "cnv_size", "size_proportion", "cnv_start", "cnv_end")
```

#single cnv
```{r}
for (row_number in 2:dim(Single_CNV)[1]){
  length = as.numeric(Single_CNV$length[row_number])
  cnv_start_position = as.numeric(Single_CNV$cnv_start[row_number])
  cnv_size = as.numeric(Single_CNV$cnv_size[row_number])
  
  total_number = as.numeric(Single_CNV$total_number_of_samples[row_number])
  number_no_cnv = as.numeric(Single_CNV$cn2_number_of_samples[row_number])
  number_cnv_cn1 = as.numeric(Single_CNV$cn1_number_of_samples[row_number])
  number_cnv_cn3 = as.numeric(Single_CNV$cn3_number_of_samples[row_number])
  
  for (n in 1:5){
    stimulate_logR = data.frame("position" = 1:length)
    #no cnv stimulated data
    for (i in 1:number_no_cnv){
      column_name = paste("sample", i, sep = "_")
      stimulate_sample = as.data.frame(rnorm(length, mean = mean_cn2, sd = sd_cn2))
      colnames(stimulate_sample) = column_name
      stimulate_logR = cbind(stimulate_logR, stimulate_sample)
    }
    #cn1 stimulated data
    for (i in 0:number_cnv_cn1){
      column_name = paste("sample", number_no_cnv+i, sep = "_")
      cnv_cn = 1
      stimulate_segment_before_cnv = data.frame("position" = 1:(cnv_start_position-1), "reads" = rnorm((cnv_start_position-1), mean = mean_cn2, sd = sd_cn2))
      stimulate_segment_cnv = data.frame("position" = cnv_start_position:(cnv_start_position+cnv_size-1), "reads" = rnorm((cnv_size), mean = mean_cn1, sd = sd_cn1))
      stimulate_segment_after_cnv = data.frame("position" = (cnv_start_position+cnv_size):length, "reads" = rnorm((length-cnv_start_position-cnv_size+1), mean = mean_cn2, sd = sd_cn2))
      stimulate_sample = rbind(stimulate_segment_before_cnv, stimulate_segment_cnv, stimulate_segment_after_cnv)[2]
      colnames(stimulate_sample) = column_name
      stimulate_logR = cbind(stimulate_logR, stimulate_sample)
    }
    #cn3 stimulated data
    for (i in 0:number_cnv_cn3){
      column_name = paste("sample", number_no_cnv+number_cnv_cn1+i, sep = "_")
      cnv_cn = 3
      stimulate_segment_before_cnv = data.frame("position" = 1:(cnv_start_position-1), "reads" = rnorm((cnv_start_position-1), mean = mean_cn2, sd = sd_cn2))
      stimulate_segment_cnv = data.frame("position" = cnv_start_position:(cnv_start_position+cnv_size-1), "reads" = rnorm((cnv_size), mean = mean_cn1, sd = sd_cn1))
      stimulate_segment_after_cnv = data.frame("position" = (cnv_start_position+cnv_size):length, "reads" = rnorm((length-cnv_start_position-cnv_size+1), mean = mean_cn2, sd = sd_cn2))
      stimulate_sample = rbind(stimulate_segment_before_cnv, stimulate_segment_cnv, stimulate_segment_after_cnv)[2]
      colnames(stimulate_sample) = column_name
      stimulate_logR = cbind(stimulate_logR, stimulate_sample)
    }
    
    writeFileName = paste(paste(paste(paste(paste(paste(paste(paste("/Users/Yibing/Bioinfo-Master-Thesis/Data/stimulate data/SD_",total_number,sep = ""), number_no_cnv,sep = "_"), number_cnv_cn1, sep = "_"), number_cnv_cn3, sep = "_"), cnv_size, sep = "_"), "run", sep = "_"), n, sep = ""), "csv", sep = ".")
    writeFileName
    write.csv(stimulate_logR, file = writeFileName)
  }
}



```


#"/Users/Yibing/Bioinfo-Master-Thesis/Data/stimulate data/"


```{r fig.height=16, fig.width=12}
library(reshape)
library(ggplot2)
result.plot = melt(stimulate_logR, "position")

ggplot(data=result.plot) + 
  geom_point(aes(position, value, group=variable, color = variable)) + 
  ylim(-5,5) 

```



#piecewise constant fitting


